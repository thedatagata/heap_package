
# **Heap Package Docs**

## **Package Description**

> The purpose of this DBT project is to help folks with getting started with Heap data synced to a data warehouse via Heap Connect. 
> This project comes with the following baked in: 
> 1. A heap_sources.yml file which includes documentation, freshness checks, and basic tests for the built-in views that ship with Heap Connect
> 2. Logic to handle incremental table transformations of the source data synced to your warehouse via Heap Connect
> 3. Macros which can be used to quickly spin up attribution and funnel analysis 
> 4. An opinionated viewpoint on how to best structure DBT projects in terms of folder structure and naming conventions in order to promote adoption and collaboration

## **Materialized Table Schemas**

### **stg_heap_events_all_inc_fct** 

*This table contains a row for each event synced to Heap. This table automatically includes pageviews but will also include events toggled to sync via Heap Connect in the Heap UI*

| Column Name                 | Description                                                                                                                                                          | Source                      |
|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
| heap_user_id                | Unique ID generated by Heap and stored as a cookie                                                                                                                   | Heap                        |
| heap_session_id             | Unique ID generated by Heap and stored as a cookie                                                                                                                   | Heap                        |
| heap_event_name             | The name of the event which will either be pageview or the category plus name of the event toggled to sync                                                           | Heap                        |
| heap_event_time             | The timestamp at which the event occurred                                                                                                                            | Heap                        |
| heap_session_event_sequence | The order in which the event occurred within the session for the user                                                                                                | src_heap_events_all_eph     |
| heap_event_funnel_position  | If the event name matches a string within the funnel_events variable found in the dbt_project yml file, the index value for that string within that list is returned | stg_heap_events_all_inc_fct |
| heap_event_is_conversion    | Flags whether or not the event name matches a string provided within the conversion events variable                                                                  |                             |

### **stg_heap_pageview_sessions_inc_fct**

| Column Name     | Description                                        | Source        |
|-----------------|----------------------------------------------------|---------------|
| heap_user_id    | Unique ID generated by Heap and stored as a cookie | Heap Built In |
| heap_session_id | Unique ID generated by Heap and stored as a cookie | Heap Built In |
### **stg_heap_sessions_inc_fct**

| Column Name     | Description                                        | Source        |
|-----------------|----------------------------------------------------|---------------|
| heap_user_id    | Unique ID generated by Heap and stored as a cookie | Heap Built In |
| heap_session_id | Unique ID generated by Heap and stored as a cookie | Heap Built In |
## **Incremental Logic** 

### **Warehouse Specific Configs**

#### **Snowflake** 

- [Snowflake Configurations](https://docs.getdbt.com/reference/resource-configs/snowflake-configs)
- [Snowflake Incremental Config](https://docs.getdbt.com/reference/resource-configs/snowflake-configs#merge-behavior-incremental-models)

```
{{
  config(
    unique_key='replace_me_w_unique_id'
  )
}}
```

#### **Big Query** 

- [BigQuery Configurations](https://docs.getdbt.com/reference/resource-configs/bigquery-configs)
- [BigQuery Incremental Config](https://docs.getdbt.com/reference/resource-configs/bigquery-configs#merge-behavior-incremental-models)

```
{{ config(
  partition_by={
      "field":"heap_pageview_time",
      "data_type":"timestamp",
      "granularity":"day"
    },
    cluster_by = ['replace_me_w_unique_id'],
    unique_key = 'replace_me_w_unique_id'
  )
}}
```

#### **Redshift** 

- [Redshift Configurations](https://docs.getdbt.com/reference/resource-configs/redshift-configs)
- [Redshift Optimization](https://docs.getdbt.com/reference/resource-configs/redshift-configs#performance-optimizations)

```
{{
  config(
    sort = 'heap_event_time',
    dist = 'heap_event_id',
    unique_key = 'replace_me_w_unique_id'
  )
}}
```

## **Funnel Analysis** 

## **Attribution**
