version: 2

sources:
  - name: heap 
    tables:
      - name: user_migrations
        description: This table keeps track of every identity call made to heap and logs the user id change and time
        columns:
          - name: from_user_id 
            identifier: heap_legacy_cookie_id
            description: The anonymous heap generated cookie id set at the time of the identify call
            tests:
              - not_null
          - name: to_user_id 
            identifier: heap_identity_user_id
            description: A hashed version of the user identity that all anonymous ids will be converted to upon identification
            tests:
              - not_null
              - unique

      - name: users
        description: This table includes a unique row for each Heap User ID. Heap will automatically merge these users when they have the same identity value. This means that multiple rows in this table could refer to the same user. 
        freshness:
          warn_after:
            count: 1
            period: day
        columns:
          - name: user_id 
            identifier: heap_user_id
            description: Unique ID of user, randomly generated by Heap.
            tests:
              - not_null
              - unique
          - name: joindate
            identifier: heap_user_first_session_time
            description: The timestamp that this user was first detected by Heap
          - name: last_modified
            identifier: heap_user_last_updated
            description: The last time this user was merged with another user as a result of both users being identified with the same identity value 
          - name: identity
            identifier: customer_user_identity
            description: An identifier unique to customer set to identify a user 
          - name: email
            identifier: customer_customer_email
            description: The email the customer provided upon submitting an order or creating an account. 

      - name: sessions
        description: On web, a session ends after 30 minutes of pageview inactivity from the user. On mobile, a session ends after 5 minutes of inactivity, regardless of whether the appâ€™s background or foreground state.
        freshness:
          warn_after:
            count: 1
            period: day
        columns: 
         - name: session_id
           identifier: heap_session_id
           description: ID of associated session, randomly generated by Heap
           tests:
             - not_null
             - unique
         - name: user_id
           identifier: heap_user_id
           description: ID of associated user, randomly generated by Heap
         - name: time
           identifier: heap_session_start_time
           description: Timestamp without timezone of when session started 
         - name: library
           identifier: heap_session_source
           description: Version of Heap library which initiated the session
         - name: platform 
           identifier: heap_user_platform
           description: users operating system
         - name: device_type
           identifier: heap_user_device_type
           description: Mobile, Tablet, or Desktop
         - name: country
           identifier: heap_session_country 
           description: country associated with the ip address of the session 
         - name: region
           identifier: heap_session_region
           description: region or state associated with the ip address of the session 
         - name: city
           identifier: heap_session_city
           description: city associated with the ip address of the session 
         - name: ip
           identifier: heap_session_ip
           description: the ip address associated with the users session 
         - name: referrer
           identifier: heap_session_referrer
           description: URL that linked to your site and initiated the session. If the user navigated directly to your site, or referral headers were stripped, then this value will appear as NULL
         - name: landing_page 
           identifier: heap_session_landing_page
           description: URL of the first pageview of the session 
         - name: landing_page_query
           identifier: heap_session_landing_page_query
           description: The query parameters of the first page of the users session
         - name: landing_page_hash 
           identifier: heap_session_landing_page_hash
           description: The hash route of the first page of the users session
         - name: browser 
           identifier: heap_session_browser
           description: users browser used during the session 
         - name: utm_source 
           identifier: heap_session_utm_source
           description: value of the utm_source query parameter
         - name: utm_campaign 
           identifier: heap_session_utm_campaign
           description: value of the utm_campaign query parameter
         - name: utm_medium 
           identifier: heap_session_utm_medium
           description: value of the utm_medium query parameter
         - name: utm_term
           identifier: heap_session_utm_term
           description: value of the utm_term query parameter
         - name: utm_content 
           identifier: heap_session_utm_content
           description: value of the utm_content query parameter
         - name: device
           identifier: heap_session_device
           description: users device model
      
      - name: pageviews
        description: Heap will create a table that contains every pageview by default
        freshness:
          warn_after:
            count: 1
            period: day
        columns: 
         - name: event_id
           identifier: heap_pageview_id
           description: Unique ID of associated pageview event
           tests:
            - not_null
            - unique
         - name: time 
           identifier: heap_pageview_time
           description: Timestamp without timezone of when the pageview occurred
         - name: user_id
           identifier: heap_user_id
           description: Unique ID of associated user, randomly generated by Heap
         - name: session_id
           identifier: heap_session_id
           description: Unique ID of associated session, randomly generated by Heap
         - name: domain
           identifier: heap_pageview_domain
           description: The domain component of the url that points to the page the user viewed 
         - name: path
           identifier: heap_pageview_path
           description: The path component of the url that points to the page the user viewed 
         - name: query
           identifier: heap_pageview_query
           description: The query component of the url that points to the page the user viewed 
         - name: hash
           identifier: heap_pageview_hash
           description: The hash component of the url that points to the page the user viewed 
         - name: title
           identifier: heap_pageview_title
           description: The html title value for the page that the user viewed 
         - name: heap_previous_page
           identifier: heap_pageview_previous_page
           description: The previous pageview URL

      - name: all_events
        description: Heap will create a table called all_events, which contains all defined or custom API events that you have elected to sync via Heap Connect
        freshness:
          warn_after:
            count: 1
            period: day
        columns: 
         - name: event_id 
           identifier: heap_event_id
           description: Unique ID of associated event, randomly generated by Heap
         - name: user_id
           identifier: heap_user_id
           description: Unique ID of associated user, randomly generated by Heap
         - name: session_id
           identifier: heap_session_id
           description: Unique ID of associated session, randomly generated by Heap
         - name: time
           identifier: heap_event_time
           description: Timestamp without timezone of when event happened
         - name: event_table_name
           identifier: heap_event_name
           description: Name of the view where similar events can be found